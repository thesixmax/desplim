<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Deterministically merge a set of polygons with possible parameters defined by the user. — desplim_merge • desplim</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Deterministically merge a set of polygons with possible parameters defined by the user. — desplim_merge"><meta name="description" content="Function for merging a set of polygons, with optinal rules
defined by the user. The merging process is deterministic, leading to
reproducible results on subsequent runs with the same input data and rules."><meta property="og:description" content="Function for merging a set of polygons, with optinal rules
defined by the user. The merging process is deterministic, leading to
reproducible results on subsequent runs with the same input data and rules."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">desplim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Deterministically merge a set of polygons with possible parameters defined by the user.</h1>

      <div class="d-none name"><code>desplim_merge.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Function for merging a set of polygons, with optinal rules
defined by the user. The merging process is deterministic, leading to
reproducible results on subsequent runs with the same input data and rules.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">desplim_merge</span><span class="op">(</span></span>
<span>  <span class="va">input_polygons</span>,</span>
<span>  input_buildings <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  compact_method <span class="op">=</span> <span class="st">"desplim"</span>,</span>
<span>  compact_threshold <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  compact_allow <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  area_threshold <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  enclosed_threshold <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  building_threshold <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-input-polygons">input_polygons<a class="anchor" aria-label="anchor" href="#arg-input-polygons"></a></dt>
<dd><p>object of class sf of type POLYGON to be merged.</p></dd>


<dt id="arg-input-buildings">input_buildings<a class="anchor" aria-label="anchor" href="#arg-input-buildings"></a></dt>
<dd><p>object of class sf of type POLYGON or MULTIPOLYGON.
An optional sf object representing buildings which should be considered when
merging. Default is <code>NULL</code>.</p></dd>


<dt id="arg-compact-method">compact_method<a class="anchor" aria-label="anchor" href="#arg-compact-method"></a></dt>
<dd><p>string; chosen method for calculating compactness of
polygons. Default is <code>"desplim"</code>, using the internal <code>desplim_compactness</code>
function. Other options include <code>"polsby"</code>, <code>"schwartz"</code> and <code>"convex_hull"</code>
from the <code>redistmetrics</code> package.</p></dd>


<dt id="arg-compact-threshold">compact_threshold<a class="anchor" aria-label="anchor" href="#arg-compact-threshold"></a></dt>
<dd><p>numerical; the baseline expected compactness of the
output polygons. Default is 0.7.</p></dd>


<dt id="arg-compact-allow">compact_allow<a class="anchor" aria-label="anchor" href="#arg-compact-allow"></a></dt>
<dd><p>numerical; the fraction of polygons allowed to fall
below <code>compact_tolerance</code>. Default is 0.2.</p></dd>


<dt id="arg-area-threshold">area_threshold<a class="anchor" aria-label="anchor" href="#arg-area-threshold"></a></dt>
<dd><p>numerical; the minimum required area of merged
polygons. Default is 10000 units.</p></dd>


<dt id="arg-enclosed-threshold">enclosed_threshold<a class="anchor" aria-label="anchor" href="#arg-enclosed-threshold"></a></dt>
<dd><p>numerical; the fraction of a polygon border shared
with a single neighbour for it to be considered enclosed (and flagged for
merging). Default is 0.8.</p></dd>


<dt id="arg-building-threshold">building_threshold<a class="anchor" aria-label="anchor" href="#arg-building-threshold"></a></dt>
<dd><p>integer; the minimum number of required buildings
within merged polygons if <code>input_buildings</code> is provided. Default is 5, but
sis set to 0 if <code>input_buildings</code> is not provided.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An sf object of POLYGONs resulting from the deterministic merge.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>There are no requirements for all polygons being adjacent to each
other. Although named <code>input_buildings</code>, any sf object of type POLYGON or
MULTIPOLYGON can be provided for this argument. For details about the
compactness metric, please see the dedicated vignette. It is not recommended
to set <code>compact_allow</code> too close to 1 and <code>compact_tolerance</code> too low.
This is especially true if <code>compact_method</code> is set to <code>"polsby"</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Create grid</span></span></span>
<span class="r-in"><span><span class="va">crs</span> <span class="op">&lt;-</span> <span class="fl">32632</span></span></span>
<span class="r-in"><span><span class="va">grid_area</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="fl">0</span>, ymin <span class="op">=</span> <span class="fl">0</span>, xmax <span class="op">=</span> <span class="fl">1200</span>, ymax <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  crs <span class="op">=</span> <span class="va">crs</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">grid_poly</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html" class="external-link">st_make_grid</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">grid_area</span>,</span></span>
<span class="r-in"><span>  cellsize <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  square <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">grid_poly</span><span class="op">)</span>, border <span class="op">=</span> <span class="st">'grey'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create buildings</span></span></span>
<span class="r-in"><span><span class="va">n_buildings</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">420</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">building_centers</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_sample.html" class="external-link">st_sample</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="va">grid_area</span><span class="op">)</span>, size <span class="op">=</span> <span class="va">n_buildings</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">list_of_buildings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">building_centers</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">point</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">point</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">point</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">width</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, min <span class="op">=</span> <span class="fl">5</span>, max <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">height</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, min <span class="op">=</span> <span class="fl">5</span>, max <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">corners</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">width</span> <span class="op">/</span> <span class="fl">2</span>, <span class="va">y</span> <span class="op">-</span> <span class="va">height</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x</span> <span class="op">+</span> <span class="va">width</span> <span class="op">/</span> <span class="fl">2</span>, <span class="va">y</span> <span class="op">-</span> <span class="va">height</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x</span> <span class="op">+</span> <span class="va">width</span> <span class="op">/</span> <span class="fl">2</span>, <span class="va">y</span> <span class="op">+</span> <span class="va">height</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">width</span> <span class="op">/</span> <span class="fl">2</span>, <span class="va">y</span> <span class="op">+</span> <span class="va">height</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">width</span> <span class="op">/</span> <span class="fl">2</span>, <span class="va">y</span> <span class="op">-</span> <span class="va">height</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">corners</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, crs <span class="op">=</span> <span class="va">crs</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">buildings_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">list_of_buildings</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">buildings_sf</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">'slateblue3'</span>, border <span class="op">=</span> <span class="cn">NA</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Merge with default settings</span></span></span>
<span class="r-in"><span><span class="va">grid_merged</span> <span class="op">&lt;-</span> <span class="fu">desplim_merge</span><span class="op">(</span></span></span>
<span class="r-in"><span>  input_polygon <span class="op">=</span> <span class="va">grid_poly</span>,</span></span>
<span class="r-in"><span>  input_buildings <span class="op">=</span> <span class="va">buildings_sf</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Linking to GEOS 3.12.1, GDAL 3.8.4, PROJ 9.4.0; sf_use_s2() is TRUE</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">grid_merged</span>, n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">grid_merged</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Simple feature collection with 12 features and 3 fields</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Geometry type: POLYGON</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dimension:     XY</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bounding box:  xmin: 0 ymin: 0 xmax: 1200 ymax: 1000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Projected CRS: WGS 84 / UTM zone 32N</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                          geometry   area compactness building</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  POLYGON ((700 700, 700 800,...  20000   0.9410508        5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  POLYGON ((200 400, 200 500,...  40000   0.9451730        5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  POLYGON ((0 200, 0 300, 0 4... 100000   0.9327796        7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  POLYGON ((1000 200, 1000 30... 100000   0.9327796        8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  POLYGON ((400 600, 400 700,...  40000   0.9451730        5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  POLYGON ((600 600, 600 700,...  40000   0.9451730        5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  POLYGON ((0 900, 0 1000, 10... 150000   0.9374167       10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  POLYGON ((200 300, 300 300,... 160000   0.9030667       15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  POLYGON ((600 300, 600 400,... 200000   0.9408510       11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 POLYGON ((400 500, 300 500,...  80000   0.9454119        8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11 POLYGON ((900 700, 900 800,... 170000   0.9297749       13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12 POLYGON ((500 900, 500 1000... 100000   0.9138095        8</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">grid_merged</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">4</span>, border <span class="op">=</span> <span class="st">'tomato3'</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="desplim_merge-1.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sixten Maximillian Thestrup.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

